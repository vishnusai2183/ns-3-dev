<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Flow Monitor &#8212; ns-3 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=039e1c02" />
    <script src="../../../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="flow-monitor">
<h1>Flow Monitor<a class="headerlink" href="#flow-monitor" title="Link to this heading">¶</a></h1>
<section id="model-description">
<h2>Model Description<a class="headerlink" href="#model-description" title="Link to this heading">¶</a></h2>
<p>The source code for the module lives in the directory <code class="docutils literal notranslate"><span class="pre">src/flow-monitor</span></code>.</p>
<p>The Flow Monitor module goal is to provide a flexible system to measure the
performance of network protocols. The module uses probes, installed in network
nodes, to track the packets exchanged by the nodes, and it will measure
a number of parameters. Packets are divided according to the flow they belong
to, where each flow is defined according to the probe’s characteristics (e.g.,
for IP, a flow is defined as the packets with the same {protocol, source (IP, port),
destination (IP, port)} tuple.</p>
<p>The statistics are collected for each flow can be exported in XML format. Moreover,
the user can access the probes directly to request specific stats about each flow.</p>
<section id="design">
<h3>Design<a class="headerlink" href="#design" title="Link to this heading">¶</a></h3>
<p>Flow Monitor module is designed in a modular way. It can be extended by subclassing
<code class="docutils literal notranslate"><span class="pre">ns3::FlowProbe</span></code> and <code class="docutils literal notranslate"><span class="pre">ns3::FlowClassifier</span></code>.
Typically, a subclass of <code class="docutils literal notranslate"><span class="pre">ns3::FlowProbe</span></code> works by listening to the appropriate
class Traces, and then uses its own <code class="docutils literal notranslate"><span class="pre">ns3::FlowClassifier</span></code> subclass to classify
the packets passing though each node.</p>
<p>Each Probe can try to listen to other classes traces (e.g., <code class="docutils literal notranslate"><span class="pre">ns3::Ipv4FlowProbe</span></code>
will try to use any <code class="docutils literal notranslate"><span class="pre">ns3::NetDevice</span></code> trace named <code class="docutils literal notranslate"><span class="pre">TxQueue/Drop</span></code>) but this
is something that the user should not rely into blindly, because the trace is not
guaranteed to be in every type of <code class="docutils literal notranslate"><span class="pre">ns3::NetDevice</span></code>. As an example,
<code class="docutils literal notranslate"><span class="pre">CsmaNetDevice</span></code> and <code class="docutils literal notranslate"><span class="pre">PointToPointNetDevice</span></code> have a <code class="docutils literal notranslate"><span class="pre">TxQueue/Drop</span></code> trace, while
<code class="docutils literal notranslate"><span class="pre">WiFiNetDevice</span></code> does not.</p>
<p>The full module design is described in <a class="reference internal" href="#flowmonitor" id="id1"><span>[FlowMonitor]</span></a></p>
</section>
<section id="scope-and-limitations">
<h3>Scope and Limitations<a class="headerlink" href="#scope-and-limitations" title="Link to this heading">¶</a></h3>
<p>At the moment, probes and classifiers are available only for IPv4 and IPv6.</p>
<p>IPv4 and IPv6 probes will classify packets in four points:</p>
<ul class="simple">
<li><p>When a packet is sent (SendOutgoing IPv[4,6] traces)</p></li>
<li><p>When a packet is forwarded (UnicastForward IPv[4,6] traces)</p></li>
<li><p>When a packet is received (LocalDeliver IPv[4,6] traces)</p></li>
<li><p>When a packet is dropped (Drop IPv[4,6] traces)</p></li>
</ul>
<p>Since the packets are tracked at IP level, any retransmission caused by L4 protocols (e.g., TCP)
will be seen by the probe as a new packet.</p>
<p>A Tag will be added to the packet (<code class="docutils literal notranslate"><span class="pre">ns3::Ipv[4,6]FlowProbeTag</span></code>). The tag will carry
basic packet’s data, useful for the packet’s classification.</p>
<p>It must be underlined that only L4 (TCP, UDP) packets are, so far, classified.
Moreover, only unicast packets will be classified.
These limitations may be removed in the future.</p>
<p>The data collected for each flow are:</p>
<ul class="simple">
<li><p>timeFirstTxPacket: when the first packet in the flow was transmitted;</p></li>
<li><p>timeLastTxPacket: when the last packet in the flow was transmitted;</p></li>
<li><p>timeFirstRxPacket: when the first packet in the flow was received by an end node;</p></li>
<li><p>timeLastRxPacket: when the last packet in the flow was received;</p></li>
<li><p>delaySum: the sum of all end-to-end delays for all received packets of the flow;</p></li>
<li><p>jitterSum: the sum of all end-to-end delay jitter (delay variation) values for all received packets of the flow, as defined in <span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3393.html"><strong>RFC 3393</strong></a>;</p></li>
<li><p>txBytes, txPackets: total number of transmitted bytes / packets for the flow;</p></li>
<li><p>rxBytes, rxPackets: total number of received bytes / packets for the flow;</p></li>
<li><p>lostPackets: total number of packets that are assumed to be lost (not reported over 10 seconds);</p></li>
<li><p>timesForwarded: the number of times a packet has been reportedly forwarded;</p></li>
<li><p>delayHistogram, jitterHistogram, packetSizeHistogram: histogram versions for the delay, jitter, and packet sizes, respectively;</p></li>
<li><p>packetsDropped, bytesDropped: the number of lost packets and bytes, divided according to the loss reason code (defined in the probe).</p></li>
</ul>
<p>It is worth pointing out that the probes measure the packet bytes including IP headers.
The L2 headers are not included in the measure.</p>
<p>These stats will be written in XML form upon request (see the Usage section).</p>
<p>Due to the above design, FlowMonitor can not generate statistics when used with DSR routing
protocol (because DSR forwards packets using broadcast addresses)</p>
<section id="the-lost-packets-problem">
<h4>The “lost” packets problem<a class="headerlink" href="#the-lost-packets-problem" title="Link to this heading">¶</a></h4>
<p>At the end of a simulation, Flow Monitor could report about “lost” packets, i.e.,
packets that Flow Monitor have lost track of.</p>
<p>It is important to keep in mind that Flow Monitor records the packets statistics by
intercepting them at a given network level - let’s say at IP level. When the simulation
ends, any packet queued for transmission below the IP level will be considered as lost.</p>
<p>It is strongly suggested to consider this point when using Flow Monitor. The user can choose to:</p>
<ul class="simple">
<li><p>Ignore the lost packets (if their number is a statistically irrelevant quantity), or</p></li>
<li><p>Stop the Applications before the actual Simulation End time, leaving enough time between the two for the queued packets to be processed.</p></li>
</ul>
<p>The second method is the suggested one. Usually a few seconds are enough (the
exact value depends on the network type).</p>
<p>It is important to stress that “lost” packets could be anywhere in the network, and could count
toward the received packets or the dropped ones. Ideally, their number should be zero or a minimal
fraction of the other ones, i.e., they should be “statistically irrelevant”.</p>
</section>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h3>
<div role="list" class="citation-list">
<div class="citation" id="flowmonitor" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">FlowMonitor</a><span class="fn-bracket">]</span></span>
<ol class="upperalpha simple" start="7">
<li><p>Carneiro, P. Fortuna, and M. Ricardo. 2009. FlowMonitor: a network monitoring framework for the network simulator 3 (NS-3). In Proceedings of the Fourth International ICST Conference on Performance Evaluation Methodologies and Tools (VALUETOOLS ‘09). <a class="reference external" href="http://dx.doi.org/10.4108/ICST.VALUETOOLS2009.7493">http://dx.doi.org/10.4108/ICST.VALUETOOLS2009.7493</a> (Full text: <a class="reference external" href="https://dl.acm.org/doi/abs/10.4108/ICST.VALUETOOLS2009.7493">https://dl.acm.org/doi/abs/10.4108/ICST.VALUETOOLS2009.7493</a>)</p></li>
</ol>
</div>
</div>
</section>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p>The module usage is extremely simple. The helper will take care of about everything.</p>
<p>The typical use is:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Flow monitor</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">FlowMonitor</span><span class="o">&gt;</span><span class="w"> </span><span class="n">flowMonitor</span><span class="p">;</span>
<span class="n">FlowMonitorHelper</span><span class="w"> </span><span class="n">flowHelper</span><span class="p">;</span>
<span class="n">flowMonitor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flowHelper</span><span class="p">.</span><span class="n">InstallAll</span><span class="p">();</span>

<span class="o">-</span><span class="n">yourApplicationsContainer</span><span class="o">-</span><span class="p">.</span><span class="n">Stop</span><span class="p">(</span><span class="n">Seconds</span><span class="p">(</span><span class="n">stop_time</span><span class="p">));;</span>
<span class="n">Simulator</span><span class="o">::</span><span class="n">Stop</span><span class="p">(</span><span class="n">Seconds</span><span class="p">(</span><span class="n">stop_time</span><span class="o">+</span><span class="n">cleanup_time</span><span class="p">));</span>
<span class="n">Simulator</span><span class="o">::</span><span class="n">Run</span><span class="p">();</span>

<span class="n">flowMonitor</span><span class="o">-&gt;</span><span class="n">SerializeToXmlFile</span><span class="p">(</span><span class="s">&quot;NameOfFile.xml&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
<p>the <code class="docutils literal notranslate"><span class="pre">SerializeToXmlFile()</span></code> function 2nd and 3rd parameters are used respectively to
activate/deactivate the histograms and the per-probe detailed stats.
Other possible alternatives can be found in the Doxygen documentation, while
<code class="docutils literal notranslate"><span class="pre">cleanup_time</span></code> is the time needed by in-flight packets to reach their destinations.</p>
<section id="helpers">
<h3>Helpers<a class="headerlink" href="#helpers" title="Link to this heading">¶</a></h3>
<p>The helper API follows the pattern usage of normal helpers.
Through the helper you can install the monitor in the nodes, set the monitor attributes, and
print the statistics.</p>
<p>One important thing is: the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::FlowMonitorHelper</span></code> must be instantiated only
once in the main.</p>
</section>
<section id="attributes">
<h3>Attributes<a class="headerlink" href="#attributes" title="Link to this heading">¶</a></h3>
<p>The module provides the following attributes in <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::FlowMonitor</span></code>:</p>
<ul class="simple">
<li><p>MaxPerHopDelay (Time, default 10s): The maximum per-hop delay that should be considered;</p></li>
<li><p>StartTime (Time, default 0s): The time when the monitoring starts;</p></li>
<li><p>DelayBinWidth (double, default 0.001): The width used in the delay histogram;</p></li>
<li><p>JitterBinWidth (double, default 0.001): The width used in the jitter histogram;</p></li>
<li><p>PacketSizeBinWidth (double, default 20.0): The width used in the packetSize histogram;</p></li>
<li><p>FlowInterruptionsBinWidth (double, default 0.25): The width used in the flowInterruptions histogram;</p></li>
<li><p>FlowInterruptionsMinTime (double, default 0.5): The minimum inter-arrival time that is considered a flow interruption.</p></li>
</ul>
</section>
<section id="output">
<h3>Output<a class="headerlink" href="#output" title="Link to this heading">¶</a></h3>
<p>The main model output is an XML formatted report about flow statistics. An example is:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="n">xml</span><span class="w"> </span><span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span><span class="w"> </span><span class="o">?&gt;</span>
<span class="o">&lt;</span><span class="n">FlowMonitor</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">FlowStats</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">Flow</span><span class="w"> </span><span class="n">flowId</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="n">timeFirstTxPacket</span><span class="o">=</span><span class="s">&quot;+0.0ns&quot;</span><span class="w"> </span><span class="n">timeFirstRxPacket</span><span class="o">=</span><span class="s">&quot;+20067198.0ns&quot;</span><span class="w"> </span><span class="n">timeLastTxPacket</span><span class="o">=</span><span class="s">&quot;+2235764408.0ns&quot;</span><span class="w"> </span><span class="n">timeLastRxPacket</span><span class="o">=</span><span class="s">&quot;+2255831606.0ns&quot;</span><span class="w"> </span><span class="n">delaySum</span><span class="o">=</span><span class="s">&quot;+138731526300.0ns&quot;</span><span class="w"> </span><span class="n">jitterSum</span><span class="o">=</span><span class="s">&quot;+1849692150.0ns&quot;</span><span class="w"> </span><span class="n">lastDelay</span><span class="o">=</span><span class="s">&quot;+20067198.0ns&quot;</span><span class="w"> </span><span class="n">txBytes</span><span class="o">=</span><span class="s">&quot;2149400&quot;</span><span class="w"> </span><span class="n">rxBytes</span><span class="o">=</span><span class="s">&quot;2149400&quot;</span><span class="w"> </span><span class="n">txPackets</span><span class="o">=</span><span class="s">&quot;3735&quot;</span><span class="w"> </span><span class="n">rxPackets</span><span class="o">=</span><span class="s">&quot;3735&quot;</span><span class="w"> </span><span class="n">lostPackets</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="n">timesForwarded</span><span class="o">=</span><span class="s">&quot;7466&quot;</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;/</span><span class="n">Flow</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;/</span><span class="n">FlowStats</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">Ipv4FlowClassifier</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">Flow</span><span class="w"> </span><span class="n">flowId</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="n">sourceAddress</span><span class="o">=</span><span class="s">&quot;10.1.3.1&quot;</span><span class="w"> </span><span class="n">destinationAddress</span><span class="o">=</span><span class="s">&quot;10.1.2.2&quot;</span><span class="w"> </span><span class="n">protocol</span><span class="o">=</span><span class="s">&quot;6&quot;</span><span class="w"> </span><span class="n">sourcePort</span><span class="o">=</span><span class="s">&quot;49153&quot;</span><span class="w"> </span><span class="n">destinationPort</span><span class="o">=</span><span class="s">&quot;50000&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">  </span><span class="o">&lt;/</span><span class="n">Ipv4FlowClassifier</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">Ipv6FlowClassifier</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;/</span><span class="n">Ipv6FlowClassifier</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">FlowProbes</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">FlowProbe</span><span class="w"> </span><span class="n">index</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">FlowStats</span><span class="w">  </span><span class="n">flowId</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="n">packets</span><span class="o">=</span><span class="s">&quot;3735&quot;</span><span class="w"> </span><span class="n">bytes</span><span class="o">=</span><span class="s">&quot;2149400&quot;</span><span class="w"> </span><span class="n">delayFromFirstProbeSum</span><span class="o">=</span><span class="s">&quot;+0.0ns&quot;</span><span class="w"> </span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;/</span><span class="n">FlowStats</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;/</span><span class="n">FlowProbe</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">FlowProbe</span><span class="w"> </span><span class="n">index</span><span class="o">=</span><span class="s">&quot;2&quot;</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">FlowStats</span><span class="w">  </span><span class="n">flowId</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="n">packets</span><span class="o">=</span><span class="s">&quot;7466&quot;</span><span class="w"> </span><span class="n">bytes</span><span class="o">=</span><span class="s">&quot;2224020&quot;</span><span class="w"> </span><span class="n">delayFromFirstProbeSum</span><span class="o">=</span><span class="s">&quot;+199415389258.0ns&quot;</span><span class="w"> </span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;/</span><span class="n">FlowStats</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;/</span><span class="n">FlowProbe</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">FlowProbe</span><span class="w"> </span><span class="n">index</span><span class="o">=</span><span class="s">&quot;4&quot;</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">FlowStats</span><span class="w">  </span><span class="n">flowId</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="n">packets</span><span class="o">=</span><span class="s">&quot;3735&quot;</span><span class="w"> </span><span class="n">bytes</span><span class="o">=</span><span class="s">&quot;2149400&quot;</span><span class="w"> </span><span class="n">delayFromFirstProbeSum</span><span class="o">=</span><span class="s">&quot;+138731526300.0ns&quot;</span><span class="w"> </span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;/</span><span class="n">FlowStats</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;/</span><span class="n">FlowProbe</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;/</span><span class="n">FlowProbes</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">FlowMonitor</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The output was generated by a TCP flow from 10.1.3.1 to 10.1.2.2.</p>
<p>It is worth noticing that the index 2 probe is reporting more packets and more bytes than the other probes.
That’s a perfectly normal behaviour, as packets are fragmented at IP level in that node.</p>
<p>It should also be observed that the receiving node’s probe (index 4) doesn’t count the fragments, as the
reassembly is done before the probing point.</p>
</section>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h3>
<p>The examples are located in <cite>src/flow-monitor/examples</cite>.</p>
<p>Moreover, the following examples use the flow-monitor module:</p>
<ul class="simple">
<li><p>examples/matrix-topology/matrix-topology.cc</p></li>
<li><p>examples/routing/manet-routing-compare.cc</p></li>
<li><p>examples/routing/simple-global-routing.cc</p></li>
<li><p>examples/tcp/tcp-variants-comparison.cc</p></li>
<li><p>examples/wireless/wifi-multirate.cc</p></li>
<li><p>examples/wireless/wifi-hidden-terminal.cc</p></li>
</ul>
</section>
<section id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">¶</a></h3>
<p>Do not define more than one <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::FlowMonitorHelper</span></code> in the simulation.</p>
</section>
</section>
<section id="validation">
<h2>Validation<a class="headerlink" href="#validation" title="Link to this heading">¶</a></h2>
<p>The paper in the references contains a full description of the module validation against
a test network.</p>
<p>Tests are provided to ensure the Histogram correct functionality.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">ns-3</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, vishnu.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/src/flow-monitor/doc/flow-monitor.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>